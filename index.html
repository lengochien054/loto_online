<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Lô Tô Online</title>
<style>
body {
  font-family: Arial;
  background: #0f172a;
  color: #fff;
  text-align: center;
}
table {
  margin: 10px auto;
  border-collapse: collapse;
}
td {
  width: 60px;
  height: 60px;
  border: 2px solid #38bdf8;
  cursor: pointer;
  font-size: 20px;
  background: #1e293b;
}
td.marked {
  background: #22c55e;
  color: #000;
}
.controls {
  margin: 10px;
}
button {
  padding: 10px 20px;
  margin: 5px;
  background: #38bdf8;
  border: none;
  font-size: 16px;
  cursor: pointer;
}
#status {
  font-size: 22px;
  font-weight: bold;
  margin: 10px;
}
#chat {
  width: 90%;
  max-width: 500px;
  margin: auto;
  background: #1e293b;
  padding: 10px;
}
#messages {
  height: 200px;
  overflow-y: auto;
  border: 1px solid #38bdf8;
  margin-bottom: 5px;
  padding: 5px;
}
input {
  padding: 8px;
  width: 70%;
}
</style>
</head>

<body>

<h1>LÔ TÔ ONLINE</h1>

<div class="controls">
  Chọn STT bảng:
  <select id="boardSelect"></select>
</div>

<table id="board"></table>

<div class="controls">
  <button onclick="resetMarks()">XÓA NHANH</button>
</div>

<div id="status"></div>

<h2>MC ĐỌC SỐ</h2>
<iframe src="https://khongbiet.vn/lay-so-ngau-nhien-choi-lo-to/" 
width="100%" height="400" style="border:none;"></iframe>

<h2>PHÒNG CHAT</h2>
<div id="chat">
  <div id="messages"></div>
  <input id="msgInput" placeholder="Nhập tin nhắn..." />
  <button onclick="sendMsg()">Gửi</button>
</div>

<script>
const usedBoards = new Set();
const boardSelect = document.getElementById("boardSelect");
const board = document.getElementById("board");
const statusText = document.getElementById("status");

for (let i = 1; i <= 50; i++) {
  const opt = document.createElement("option");
  opt.value = i;
  opt.text = "Bảng " + i;
  boardSelect.appendChild(opt);
}

boardSelect.onchange = () => {
  if (usedBoards.has(boardSelect.value)) {
    alert("Bảng đã có người chọn!");
    boardSelect.value = "";
  } else {
    usedBoards.add(boardSelect.value);
    generateBoard();
  }
};

function generateBoard() {
  board.innerHTML = "";
  let numbers = [];

  for (let col = 0; col < 9; col++) {
    let start = col * 10 + 1;
    let end = col === 8 ? 90 : start + 9;
    let colNums = [];
    while (colNums.length < 5) {
      let n = Math.floor(Math.random() * (end - start + 1)) + start;
      if (!colNums.includes(n)) colNums.push(n);
    }
    numbers.push(colNums);
  }

  for (let r = 0; r < 5; r++) {
    let tr = document.createElement("tr");
    for (let c = 0; c < 9; c++) {
      let td = document.createElement("td");
      td.innerText = numbers[c][r];
      td.onclick = () => {
        td.classList.toggle("marked");
        checkStatus();
      };
      tr.appendChild(td);
    }
    board.appendChild(tr);
  }
}

function resetMarks() {
  document.querySelectorAll("td").forEach(td => td.classList.remove("marked"));
  statusText.innerText = "";
}

function checkStatus() {
  let rows = board.rows;
  for (let r = 0; r < rows.length; r++) {
    let marked = rows[r].querySelectorAll(".marked").length;
    if (marked === 4) statusText.innerText = "CHỜ";
    if (marked === 5) statusText.innerText = "KINH";
  }
}

// CHAT (local)
function sendMsg() {
  let msg = document.getElementById("msgInput").value;
  if (!msg) return;
  let div = document.createElement("div");
  div.innerText = msg;
  document.getElementById("messages").appendChild(div);
  document.getElementById("msgInput").value = "";
}
</script>

</body>
</html>
